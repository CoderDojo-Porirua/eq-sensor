// server.js
// where your node app starts

// init project
var express = require('express');
var app = express();
var http = require('http').Server(app);
var io = require('socket.io')(http);

var moment = require('moment');

var bodyParser = require('body-parser');
var multer = require('multer'); // v1.0.5
var upload = multer(); // for parsing multipart/form-data

app.use(bodyParser.json()); // for parsing application/json
//app.use(bodyParser.urlencoded({ extended: true })); // for parsing application/x-www-form-urlencoded



// we've started you off with Express, 
// but feel free to use whatever libs or frameworks you'd like through `package.json`.

// http://expressjs.com/en/starter/static-files.html
app.use(express.static('public'));





///////////////////////////////////////////////////////////////////////////////
// Logging stuff....
///////////////////////////////////////////////////////////////////////////////
var winston = require('winston');

//
// Requiring `winston-papertrail` will expose
// `winston.transports.Papertrail`
//
require('winston-papertrail').Papertrail;

var winstonPapertrail = new winston.transports.Papertrail({
  host: 'logs4.papertrailapp.com',
  port: 40894
})
var winstonConsole = new winston.transports.Console({
})

winstonPapertrail.on('error', function(err) {
  // Handle, report, or silently ignore connection errors and failures
});

var logger = new winston.Logger({
  transports: [winstonPapertrail, winstonConsole]
});

winston.level = 'debug'
logger.info('eq-monitor starting');

///////////////////////////////////////////////////////////////////////////////




///////////////////////////////////////////////////////////////////////////////
// Routing
///////////////////////////////////////////////////////////////////////////////


// http://expressjs.com/en/starter/basic-routing.html

///////////////////////////////////////////////////////////////////////////////
// Get the main page - this is the first request in the app - return the HTML page
///////////////////////////////////////////////////////////////////////////////

app.get("/", function (request, response) {
  response.sendFile(__dirname + '/views/index.html');
});

///////////////////////////////////////////////////////////////////////////////
// Get all the things!
///////////////////////////////////////////////////////////////////////////////

app.get("/data", function (request, response) {
  response.send(data);
});

///////////////////////////////////////////////////////////////////////////////
// Get some of the things!
///////////////////////////////////////////////////////////////////////////////

app.get("/latest_data/:count", function (request, response) {
  response.send(data.slice(0, request.params.count));
});

app.get("/latest_magnitudes/:count", function (request, response) {
  
  var magnitudes = data.slice(0, request.params.count).map(function(obj){
    return {
      time: obj.time,
      magnitude: obj.magnitude
    };
  });
  response.send(magnitudes.slice(0, request.params.count));
});

app.get("/latest_data_count", function (request, response) {
  response.send({length: data.length});
});

///////////////////////////////////////////////////////////////////////////////
// Send some data and add to the array
///////////////////////////////////////////////////////////////////////////////

function sendData(data_point){
  data_point.time = new moment();
  data.unshift(data_point);
  logger.debug(data.length);
  
  io.emit('data', data_point);
}

app.post('/data', upload.array(), function (request, response, next) {
  logger.info('Data');
  var data_point = request.body;
  
  sendData(data_point);
  
  response.sendStatus(200);
});


io.on('connection', function(socket) {
  console.log('connection')
  socket.on('data', function(msg) {
    console.log('data')
    sendData(data_point);
  });

});











///////////////////////////////////////////////////////////////////////////////
// Data structures - storing array in memory
///////////////////////////////////////////////////////////////////////////////

var now = new moment();

var data = [
/*
{
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100394787012814,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:35:46.288Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.0087890625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:35:44.254Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0090433337581968,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:35:40.365Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100196504097667,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:34:39.051Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:34:34.093Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.006156092461533,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:34:21.145Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:34:20.610Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:33:54.221Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:33:53.532Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:33:26.937Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:33:24.976Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100380624076535,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:33:19.510Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0090409709373913,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:33:01.828Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100380624076535,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:32:57.527Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:32:54.467Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100196504097667,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:32:39.265Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:32:39.154Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:32:21.779Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:51.924Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.021484375,
            "y": 0,
            "z": 1.0078125
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:44.531Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.008043366241084,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:42.511Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100380624076535,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:38.063Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.010041839186248,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": -0.0029296875,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.01,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:36.172Z"
    },
    {
        "x": "-0.02",
        "y": "-0.00",
        "z": "1.01",
        "magnitude": 1.010041839186248,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.01,
            "y": 0.01,
            "z": 1.01171875
        },
        "time": "2016-11-27T08:31:31.342Z"
    },
    {
        "x": "-0.01",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0108219133713703,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.01,
            "y": 0.0009765625,
            "z": 1.01171875
        },
        "time": "2016-11-27T08:31:31.231Z"
    },
    {
        "x": "-0.01",
        "y": "-0.01",
        "z": "1.01",
        "magnitude": 1.010851632057688,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": -0.01,
            "z": 1
        },
        "max_data": {
            "x": -0.01,
            "y": 0.01,
            "z": 1.0126953125
        },
        "time": "2016-11-27T08:31:30.754Z"
    },
    {
        "x": "-0.01",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.011798870198693,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": -0.01,
            "z": 1
        },
        "max_data": {
            "x": -0.01,
            "y": 0.01,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:30.154Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.010041839186248,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": -0.01,
            "z": 1
        },
        "max_data": {
            "x": -0.01,
            "y": 0.01,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:30.092Z"
    },
    {
        "x": "-0.02",
        "y": "-0.01",
        "z": "1.01",
        "magnitude": 1.0129895569092637,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": -0.01,
            "z": 1
        },
        "max_data": {
            "x": -0.01,
            "y": 0.01,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:29.542Z"
    },
    {
        "x": "-0.01",
        "y": "-0.01",
        "z": "1.01",
        "magnitude": 1.0148011607571326,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": -0.01,
            "z": 1
        },
        "max_data": {
            "x": -0.01,
            "y": 0.01,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:29.538Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:26.384Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100154014395124,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:31:21.374Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:30:42.853Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0061120169673132,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:30:23.061Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:29:34.455Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:29:27.329Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0109506880358392,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:29:26.498Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:29:25.523Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:29:24.838Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0070869140392995,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:29:04.202Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:28:58.095Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100196504097667,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:28:47.933Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100196504097667,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:28:45.141Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100394787012814,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.0107421875
        },
        "time": "2016-11-27T08:28:25.212Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100154014395124,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.0107421875
        },
        "time": "2016-11-27T08:28:24.940Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0109917226692136,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:28:21.509Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": -0.0009765625,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.01
        },
        "time": "2016-11-27T08:28:09.518Z"
    },
    {
        "x": "-0.02",
        "y": "-0.00",
        "z": "1.01",
        "magnitude": 1.0100380624076535,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:28:07.511Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0090220681717605,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:27:44.385Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100196504097667,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:27:32.404Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.021484375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.00390625,
            "z": 1.01
        },
        "time": "2016-11-27T08:27:28.406Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100017101915442,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:27:24.474Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100380624076535,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:27:15.040Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:27:11.173Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.010041839186248,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:27:04.094Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:53.810Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:52.364Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100154014395124,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:51.834Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100196504097667,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:49.247Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100380624076535,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:42.964Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:39.644Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0080854652442999,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:25.139Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100380624076535,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:21.315Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.01
        },
        "time": "2016-11-27T08:26:11.360Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100154014395124,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.0107421875
        },
        "time": "2016-11-27T08:25:58.206Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0109921943219842,
        "id": "tessel",
        "min_data": {
            "x": -0.03,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.0107421875
        },
        "time": "2016-11-27T08:25:51.061Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.010950216363704,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:25:37.824Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100158735482012,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.01
        },
        "time": "2016-11-27T08:25:32.227Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100154014395124,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.01
        },
        "time": "2016-11-27T08:25:24.398Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100375903093364,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.01
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.0107421875
        },
        "time": "2016-11-27T08:25:15.717Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0109936092789755,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0,
            "z": 1.01
        },
        "time": "2016-11-27T08:25:12.662Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0080627603823231,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:25:05.838Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100394787012814,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0029296875,
            "z": 1.01
        },
        "time": "2016-11-27T08:25:02.702Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100196504097667,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:24:43.907Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100394787012814,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:24:12.330Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100607228673901,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:24:12.014Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100172898729434,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.0009765625,
            "z": 1.01
        },
        "time": "2016-11-27T08:24:08.098Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100380624076535,
        "id": "tessel",
        "min_data": {
            "x": -0.0234375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:24:04.196Z"
    },
    {
        "x": "-0.02",
        "y": "0.00",
        "z": "1.01",
        "magnitude": 1.0100394787012814,
        "id": "tessel",
        "min_data": {
            "x": -0.0224609375,
            "y": 0,
            "z": 1.009765625
        },
        "max_data": {
            "x": -0.02,
            "y": 0.001953125,
            "z": 1.01
        },
        "time": "2016-11-27T08:24:01.145Z"
    },
    */
  {
    id: 'Test data',
    time: new moment(now.add(1, 'second')),
    x: 1.0,
    y: 0.0,
    z: 0.0
  },
  {
    id: 'Test data',
    time: new moment(now.add(1, 'second')),
    x: 0.0,
    y: 1.0,
    z: 0.0
  },
  {
    id: 'Test data',
    time: new moment(now.add(1, 'second')),
    x: 0.0,
    y: 0.0,
    z: 1.0
  }
];


///////////////////////////////////////////////////////////////////////////////
// Let's GO!
///////////////////////////////////////////////////////////////////////////////


// listen for requests :)

// listen for requests :)
var listener = http.listen(process.env.PORT, function () {
  console.log('Your app is listening on port ' + listener.address().port);
});

/*
var listener = app.listen(process.env.PORT, function () {
  logger.info('Your app is listening on port ' + listener.address().port);
});
*/